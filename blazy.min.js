/*===================================================================================================================
 * @name: [be]lazy
 * @type: javascript
 * @author: (c) Bjoern Klinggaard - @bklinggaard
 * @demo: http://dinbror.dk/blazy
 * @version: 1.0.2
 *==================================================================================================================*/
 var Blazy=function(m,h){function d(a){if(!h.querySelectorAll){var c=h.createStyleSheet();h.querySelectorAll=function(a,b,g,d,e){e=h.all;b=[];a=a.replace(/\[for\b/gi,"[htmlFor").split(",");for(g=a.length;g--;){c.addRule(a[g],"k:v");for(d=e.length;d--;)e[d].currentStyle.k&&b.push(e[d]);c.removeRule(0)}return b}}a=a||{};b.src=a.src||"data-src";b.multi=a.multi||!1;b.offset=a.offset||100;b.selector=a.selector||".b-lazy";b.onLoaded=a.onLoaded||!1;b.container=h.querySelector(a.container)||m;l=b.src;e=s(n,50);p=s(t,50);t();u(b.selector);v(b.multi,function(a){if(a.width>=m.screen.width)return l=a.src,!1});q(b.container,"scroll",e);q(b.container,"resize",e);q(b.container,"resize",p);n()}function n(){for(var a=0;a<g;a++){var c=k[a].getBoundingClientRect(),f=w+b.offset;if(0<=c.top&&0<=c.left&&c.top<=f||c.bottom<=f&&c.bottom>=0-b.offset)x(k[a]),k.splice(a,1),g-=1,a--}0===g&&d.prototype.destroy()}function x(a){if(0<a.offsetWidth&&0<a.offsetHeight&&-1===(" "+a.className+" ").indexOf(" loaded ")){var c=new Image,f=a.getAttribute(a.getAttribute(l)?l:b.src);v(b.multi,function(c){a.removeAttribute(c.src)});a.removeAttribute(b.src);c.onload=function(){a.parent?a.parent.replaceChild(c,a):a.src=f;a.className+=" loaded";b.onLoaded(a)};c.src=f}}function u(a){a=h.querySelectorAll(a);for(var c=g=a.length;c--;k.unshift(a[c]));}function t(){w=m.innerHeight||h.documentElement.clientHeight}function q(a,c,b){a.attachEvent?a.attachEvent&&a.attachEvent("on"+c,b):a.addEventListener(c,b,!1)}function r(a,b,f){a.detachEvent?a.detachEvent&&a.detachEvent("on"+b,f):a.removeEventListener(b,f,!1)}function v(a,b){if(a&&b)for(var f=a.length,d=0;d<f&&!1!==b(a[d],d);d++);}function s(a,b){var d=0;return function(){var e=+new Date;e-d<b||(d=e,a.apply(this,arguments))}}var l,b={},g=0,w,k=[],e,p;d.prototype.revalidate=function(){u(b.selector);n()};d.prototype.load=function(a){x(a)};d.prototype.destroy=function(){r(b.container,"scroll",e);r(b.container,"resize",e);r(b.container,"resize",p);g=0;k.length=0};return d}(window,document);